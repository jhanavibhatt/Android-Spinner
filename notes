package com.example.googlesignindemo

import android.content.Intent
import android.os.Bundle
import android.util.Log
import android.widget.Toast
import androidx.activity.enableEdgeToEdge
import androidx.appcompat.app.AppCompatActivity
import androidx.core.view.ViewCompat
import androidx.core.view.WindowInsetsCompat
import com.example.googlesignindemo.databinding.ActivityMain2Binding
import com.google.firebase.FirebaseApp
import com.google.firebase.auth.FirebaseAuth
import com.google.firebase.auth.FirebaseUser
import com.google.firebase.auth.OAuthProvider

class MainActivity2 : AppCompatActivity() {
    lateinit var binding: ActivityMain2Binding
    lateinit var firebaseAuth: FirebaseAuth
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        //enableEdgeToEdge()
        binding = ActivityMain2Binding.inflate(layoutInflater)
        FirebaseApp.initializeApp(this)
        setContentView(binding.root)
        firebaseAuth = FirebaseAuth.getInstance()

        // Check if the user is already signed in
        val firebaseUser: FirebaseUser? = firebaseAuth.currentUser
        if (firebaseUser != null) {
            navigateToProfile()
        }

        binding.btnSignIn.setOnClickListener {
            signInWithGoogle()
        }


}

    private fun navigateToProfile() {
        startActivity(
            Intent(this@MainActivity2, ProfileActivity::class.java)
                .setFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
        )
    }

    private fun signInWithGoogle() {
        val provider = OAuthProvider.newBuilder("google.com")

        // Start sign-in activity with Firebase OAuthProvider
        firebaseAuth.startActivityForSignInWithProvider(this, provider.build())
            .addOnSuccessListener { authResult ->
                // Sign-in successful
                val user = authResult.user
                Log.d("MainActivity", "Google sign-in successful for user: ${user?.displayName}")
                displayToast("Google sign-in successful")

                navigateToProfile()
            }
            .addOnFailureListener { e ->
                // Sign-in failed
                Log.e("MainActivity", "Google sign-in failed: ${e.message}")
                displayToast("Google sign-in failed: ${e.message}")
            }
    }
    private fun displayToast(s: String) {
        Toast.makeText(applicationContext, s, Toast.LENGTH_SHORT).show()
    }
}
